<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Documentation for System Administrators :: DDM Documentation</title>
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
    <link rel="icon" href="../../_/img/ddl_favicon_black.svg" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div>
        <a class="navbar-item" href="../.."><img src="../../_/img/DDM_Logo_Weiss.svg" height="50px"></a>
      </div>
      <div class="navbar-slogan">
        <a class="navbar-item" href="../..">Data Donation Module Documentation</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ddm" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">DDM</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="for_researchers.html">For Researchers</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="for_admins.html">For System Administrators</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="for_developers.html">For Developers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="topic_references.html">Topic References</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="about.html">About</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">DDM</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">DDM</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">main</a>
        </li>
        <li class="version">
          <a href="../develop/index.html">develop</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">DDM</a></li>
    <li><a href="for_admins.html">For System Administrators</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">main</button>
  <div class="version-menu">
    <a class="version is-current" href="for_admins.html">main</a>
    <a class="version" href="../develop/for_admins.html">develop</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/uzh/ddm/edit/main/docs/modules/ROOT/pages/for_admins.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Documentation for System Administrators</h1>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Extend section with general steps to set up Django.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Install the Django DDM package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">pip install django-ddm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the necessary entries to INSTALLED_APPS in your settings.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

INSTALLED_APPS = [
    # ...,
    'ddm',
    'ckeditor',
    'ckeditor_uploader',
    'webpack_loader',
    'rest_framework',
    'rest_framework.authtoken',
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following configuration for webpack-loader to your settings.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

WEBPACK_LOADER = {
    'DEFAULT': {
        'CACHE': True,
        'BUNDLE_DIR_NAME': 'ddm/vue/',
        'STATS_FILE': os.path.join(STATIC_ROOT, 'ddm/vue/webpack-stats.json'),
        'POLL_INTERVAL': 0.1,
        'IGNORE': [r'.+\.hot-update.js', r'.+\.map'],
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Include the DDM urls in your projects urls.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># urls.py

urlpatterns = [
    # ...
    path('ddm/', include('ddm.urls')),
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure login and logout endpoints for DDM in urls.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># urls.py

urlpatterns = [
    ...
    path('ddm/', include('ddm.urls')),
    path('login/', auth_views.LoginView.as_view(template_name='ddm/admin/auth/login.html'), name='ddm-login'),  # You can choose whatever path and template you like
    path('logout/', auth_views.LogoutView.as_view(), name='ddm-logout'),  # You can choose whatever path and template you like
]</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use DDM on a Django site together with <a href="https://wagtail.org/">wagtail</a> and you
have internationalization enabled for your wagtail urls, we recommend to use the
<code>prefix_default_language=False</code> for the i18n_patterns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># urls.py

urlpatterns += i18n_patterns(
    path('', include(wagtail_urls)),
    prefix_default_language=False
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Not doing this will cause ddm.tests.test_apis.test_participant_deletion_with_regular_login to fail.
In practice, the participant API still seems to work properly despite the test failing, however,
unexpected behaviour cannot be ruled out at this point. This will be fixed in a future version.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Add the DDM context processor to your template context processors.
This will enable the version indicator of the currently used DDM distribution
below the header in the admin interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': ['templates'],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                # ...
                'ddm.context_processors.add_ddm_version'  # Add this.
            ],
        },
    },
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure CKEditor settings in your settings.py to allow your users to upload
images and gifs in instructions and question texts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

CKEDITOR_RESTRICT_BY_USER = True  # Files uploaded by one user can only be accessed by this particular user
CKEDITOR_UPLOAD_PATH = 'uploads/'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Furthermore, add the following to your urls.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># urls.py

urlpatterns = [
    ...
    path('ckeditor/', include('ckeditor_uploader.urls')),
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>DDM uses a custom CKEditor toolbar for instruction and question text definitions
that can optionally be customized (<a href="topics/customize_ckeditor_configs.html" class="xref page">find out more</a>)</p>
</div>
<div class="paragraph">
<p>Add time zone support to your settings.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

USE_TZ = True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, an e-mail address restriction can be defined in settings.py. Only users whose e-mail address matches the defined regex pattern will be allowed to set up data donation projects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

DDM_SETTINGS = {
    'EMAIL_PERMISSION_CHECK':  r'.*(\.|@)somedomain\.com$',
},</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>python manage.py migrate</code> to create the ddm models in your database.</p>
</div>
<div class="paragraph">
<p>Run <code>python manage.py test ddm</code> to check that DDM is setup and works correctly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_optional_settings"><a class="anchor" href="#_optional_settings"></a>Optional Settings</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_default_header_images"><a class="anchor" href="#_default_header_images"></a>Default Header Images</h3>
<div class="paragraph">
<p>You can provide default images to be included in the header of the participation views.
These images will be displayed by default, but can be overwritten on a project-basis
by researchers in the project settings.</p>
</div>
<div class="paragraph">
<p>To enable default images, provide the paths to the images that you want to display
in the left and/or right part of the public header in your settings.py as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

DDM_DEFAULT_HEADER_IMG_LEFT = '/path/to/logo_left.png'
DDM_DEFAULT_HEADER_IMG_RIGHT = '/path/to/logo_right.png'</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="footer-content-bite"><a href="https://datadonation.uzh.ch"><img src="../../_/img/DataDonationLab_Logo_Schwarz.svg" height="50px"></a></div>
  <div class="footer-content-bite">© Data Donation Lab, 2023-present</div>
  <div class="footer-content-bite"><a href="https://github.com/uzh/ddm">DDM on GitHub</a></div>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
